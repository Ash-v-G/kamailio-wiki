====== Upgrade Kamailio from v5.2.x to v5.3.0 (pre-release) ======

The page contains the details about the changes that were made to old components during the development of v5.3.0 compared with what existed in v5.2.x. It does not include the brand new modules, focusing on how to upgrade database and configuration file from v5.2.x to run with Kamailio devel.

===== Previous Stable Release =====

If you look for the guidelines to upgrade to previous stable release, see:

  * [[install:upgrade:5.1.x-to-5.2.0|Upgrade Kamailio v5.1.x to v5.2.0]]

===== Remarks =====

Following tokens are used to mark the changes:

  * INF - the change doesn't really have any direct impact - no action required in old config
  * CPM - the change was used with the new value via explicit parameter in default config file from old releases
  * RCM - the change is recommended to be done if you had an explicit different or lower value for this parameter in old config
  * UPG - the change has to be done, older config does not work any longer

===== Modules =====

==== Upgraded Modules ====

  * **app_lua** - the functions exported to the old **sr** Lua module were moved to **app_lua_sr** module.

<code c>
# old config
loadmodule "app_lua.so"
modparam("app_lua", "register", "sl")

# new config
loadmodule "app_lua.so"
loadmodule "app_lua_sr.so"
modparam("app_lua_sr", "register", "sl")
</code>
==== Removed Modules ====

  * none

==== Renamed Modules ====

  * none

===== Internal Libraries =====


===== Core =====

==== Parameters ====

==== Misc ====

===== Database =====


==== MySQL Database Structure ====

Run following SQL statements in MySQL client to upgrade database structure from v5.2 to v5.3:

<code sql>
-- acc table
ALTER TABLE acc CHANGE COLUMN to_tag to_tag varchar(128) NOT NULL DEFAULT ''; -- # was varchar(64) NOT NULL DEFAULT ''
ALTER TABLE acc CHANGE COLUMN from_tag from_tag varchar(128) NOT NULL DEFAULT ''; -- # was varchar(64) NOT NULL DEFAULT ''

-- active_watchers table
ALTER TABLE active_watchers CHANGE COLUMN contact contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE active_watchers CHANGE COLUMN from_tag from_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE active_watchers CHANGE COLUMN to_tag to_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE active_watchers CHANGE COLUMN presentity_uri presentity_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE active_watchers CHANGE COLUMN local_contact local_contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE aliases CHANGE COLUMN received received varchar(255) DEFAULT NULL; -- # was varchar(128) DEFAULT NULL

ALTER TABLE carrierfailureroute CHANGE COLUMN host_name host_name varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE carrierroute CHANGE COLUMN rewrite_host rewrite_host varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''

ALTER TABLE dialog CHANGE COLUMN req_uri req_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE dialog CHANGE COLUMN caller_contact caller_contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE dialog CHANGE COLUMN callee_contact callee_contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE dialog CHANGE COLUMN to_tag to_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE dialog CHANGE COLUMN from_tag from_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE dialog CHANGE COLUMN from_uri from_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE dialog CHANGE COLUMN to_uri to_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE missed_calls CHANGE COLUMN to_tag to_tag varchar(128) NOT NULL DEFAULT ''; -- # was varchar(64) NOT NULL DEFAULT ''
ALTER TABLE missed_calls CHANGE COLUMN from_tag from_tag varchar(128) NOT NULL DEFAULT ''; -- # was varchar(64) NOT NULL DEFAULT ''

ALTER TABLE pdt CHANGE COLUMN domain domain varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE pdt CHANGE COLUMN sdomain sdomain varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE presentity CHANGE COLUMN sender sender varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE pua CHANGE COLUMN remote_contact remote_contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE pua CHANGE COLUMN watcher_uri watcher_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE pua CHANGE COLUMN contact contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE pua CHANGE COLUMN to_tag to_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE pua CHANGE COLUMN from_tag from_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE pua CHANGE COLUMN pres_uri pres_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE purplemap CHANGE COLUMN sip_user sip_user varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE purplemap CHANGE COLUMN ext_user ext_user varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE rls_presentity CHANGE COLUMN resource_uri resource_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE rls_watchers CHANGE COLUMN to_tag to_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE rls_watchers CHANGE COLUMN from_tag from_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE rls_watchers CHANGE COLUMN presentity_uri presentity_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE rls_watchers CHANGE COLUMN local_contact local_contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
ALTER TABLE rls_watchers CHANGE COLUMN contact contact varchar(255) NOT NULL; -- # was varchar(128) NOT NULL

ALTER TABLE sca_subscriptions CHANGE COLUMN to_tag to_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL
ALTER TABLE sca_subscriptions CHANGE COLUMN from_tag from_tag varchar(128) NOT NULL; -- # was varchar(64) NOT NULL

ALTER TABLE silo CHANGE COLUMN dst_addr dst_addr varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE silo CHANGE COLUMN src_addr src_addr varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''

ALTER TABLE sip_trace CHANGE COLUMN fromtag fromtag varchar(128) NOT NULL DEFAULT ''; -- # was varchar(64) NOT NULL DEFAULT ''
ALTER TABLE sip_trace CHANGE COLUMN status status varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE sip_trace CHANGE COLUMN traced_user traced_user varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE sip_trace CHANGE COLUMN totag totag varchar(128) NOT NULL DEFAULT ''; -- # was varchar(64) NOT NULL DEFAULT ''

ALTER TABLE speed_dial CHANGE COLUMN new_uri new_uri varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''

ALTER TABLE topos_d CHANGE COLUMN a_contact a_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_d CHANGE COLUMN b_contact b_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_d CHANGE COLUMN b_uri b_uri varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_d CHANGE COLUMN a_uri a_uri varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_d CHANGE COLUMN bs_contact bs_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_d CHANGE COLUMN as_contact as_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_d CHANGE COLUMN r_uri r_uri varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''

ALTER TABLE topos_t CHANGE COLUMN x_uri x_uri varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_t CHANGE COLUMN a_contact a_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_t CHANGE COLUMN b_contact b_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_t CHANGE COLUMN bs_contact bs_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_t CHANGE COLUMN b_srcaddr b_srcaddr varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_t CHANGE COLUMN as_contact as_contact varchar(512) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE topos_t CHANGE COLUMN a_srcaddr a_srcaddr varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''

ALTER TABLE uacreg CHANGE COLUMN auth_proxy auth_proxy varchar(255) NOT NULL DEFAULT ''; -- # was varchar(128) NOT NULL DEFAULT ''
ALTER TABLE uacreg ADD COLUMN socket varchar(128) NOT NULL DEFAULT '';

ALTER TABLE usr_preferences CHANGE COLUMN username username varchar(255) NOT NULL DEFAULT '0'; -- # was varchar(128) NOT NULL DEFAULT '0'

ALTER TABLE watchers CHANGE COLUMN presentity_uri presentity_uri varchar(255) NOT NULL; -- # was varchar(128) NOT NULL
</code>