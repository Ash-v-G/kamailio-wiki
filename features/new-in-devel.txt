====== Kamailio SIP Server (SER) - New Features in Devel Version ======

**Current devel version will be numbered 5.3.0 and it is planned to be released in the autum 2019**.

<fc #0000FF>
**Previous devel, current stable, version was 5.2.x (released on November, 2018), see what was new in that release at:**
</fc>
  * <fc #0000FF>http://www.kamailio.org/wiki/features/new-in-5.2.x</fc>

<fc #800000>//This is a draft of new features added in devel version, manually updated, thus not always synchronized with what is new in source code repository.//</fc>

===== New Modules =====

==== app_lua_sr ====

Old **sr** module exported to Lua scripting.

  * https://www.kamailio.org/docs/modules/devel/modules/app_lua_sr.html

==== xhttp_prom ====

Generates suitable metrics for a Prometheus monitoring platform, answering to Prometheus pull requests (HTTP requests to /metrics URL).

  * https://www.kamailio.org/docs/modules/devel/modules/xhttp_prom.html

==== kemix ====

KEMI specific extensions.

  * https://www.kamailio.org/docs/modules/devel/modules/kemix.html

==== rtp_media_server ====

Embedded RTP and media processing functionalities for Kamailio

  * https://www.kamailio.org/docs/modules/devel/modules/rtp_media_server.html

==== secfilter ====

Filters to allow/block using whitelists/blacklist based on user agents, IP addresses, countries, domains and users. SQL injection attacks prevention. Blacklist of destinations where the called number is not allowed.

  * https://www.kamailio.org/docs/modules/devel/modules/secfilter.html


===== New in existing Modules =====

==== acc_json ====

Add support for leg_info fields to the acc_json module

  * https://www.kamailio.org/docs/modules/devel/modules/acc_json.html

==== cnxcc ====

Added a new param in the cnxcc_set_max_credit() function to set the connect cost of a call.

  * https://www.kamailio.org/docs/modules/devel/modules/cnxcc.html#cnxcc.f.set_max_credit

==== dialog ====

Add new rpc commands dlg.list_match and dlg.list_match_ctx to the dialog module. They will list dialogs matching the expression given via parameters

  * https://www.kamailio.org/docs/modules/devel/modules/dialog.html#dlg.r.list_match
  * https://www.kamailio.org/docs/modules/devel/modules/dialog.html#dlg.r.list_match_ctx

==== dispatcher ====

Add a new rpc function, it will add a new destination to in-memory dispatcher list.

  * https://www.kamailio.org/docs/modules/devel/modules/dispatcher.html#dispatcher.r.add

Add a new flag 16 (1<<4) to the cfg syntax for destinations with host not having A/AAAA record.

  * https://www.kamailio.org/docs/modules/devel/modules/dispatcher.html#idm1021190300

Add a new parameter reload_delta to limit the frequency of rpc reload commands to try to avoid races of parallel reload operations.

  * https://www.kamailio.org/docs/modules/devel/modules/dispatcher.html#dispatcher.p.reload_delta


==== dialplan ====

Add reload_delta parameter to make the rate limit of maximum allowed dialplan reload configurable.

  * https://www.kamailio.org/docs/modules/devel/modules/dialplan.html#dialplan.p.reload_delta

==== uac ====

New modparam reg_gc_interval, to define a value for garbage collection interval

  * https://www.kamailio.org/docs/modules/devel/modules/uac.html#uac.p.reg_gc_interval

The uac_replace_from/uac_replace_to function (with dialog storage option) will now also work properly after a restart from Kamailio, if dialog data is stored in a database.

The uac_replace_from/uac_replace_to function will now also properly store and restore the Display Name with the dialog storage option.

==== registrar ====

New parameter lookup_filter_mode to control what filters should be applied for lookup(...) operations. Filter values are specified via filed of xavp_cfg.

  * https://www.kamailio.org/docs/modules/devel/modules/registrar.html#registrar.p.lookup_filter_mode

==== presence ====

A new rpc command presence.updateWatchers

  * https://www.kamailio.org/docs/modules/devel/modules/presence.html#presence.rpc.updateWatchers

==== siptrace ====

Add transaction and dialog level tracing to the module function sip_trace

  * https://www.kamailio.org/docs/modules/devel/modules/siptrace.html#siptrace.f.sip_trace

==== sdpops ====

Added new sdp_get_ddress_family() function to extract the IP address family from the SDP body

  * https://www.kamailio.org/docs/modules/devel/modules/sdpops.html#sdpops.f.sdp_get_address_family

==== sl ====

Add new pseudo-variables: $ltt(key) - return local generated to tag when Kamailio sends a reply.

  * https://www.kamailio.org/wiki/cookbooks/devel/pseudovariables#ltt_key_-_local_to-tag    

==== sqlops ====

Add a new parameter connect_mode, option to start even when connecting to db fails.

  * https://www.kamailio.org/docs/modules/devel/modules/sqlops.html#sqlops.p.connect_mode    

==== rr ====

Add new return value for preloaded route set to loose_route(). Now it is possible to detect from the script if a preloaded Route header was removed that pointed at the local proxy.

  * https://www.kamailio.org/docs/modules/devel/modules/rr.html#rr.f.loose_route

==== rls ====

Add a new rpc command rls.update_subs.

  * https://www.kamailio.org/docs/modules/devel/modules/rls.html#rls.rpc.update_subs

==== rtpengine ====

Introduce additional hashing algorithm SHA1 over callid for better distribution among nodes. 

  * https://www.kamailio.org/docs/modules/devel/modules/rtpengine.html#rtpengine.p.hash_algo

==== janssonrpcc ====

Add new parameter "keep_alive", send periodic tcp keepalive packets to server in order to prevent connection from closing.

  * https://www.kamailio.org/docs/modules/devel/modules/janssonrpcc.html#idm1023243564

==== textops ====

Add a new function regex_substring(itext, regex, index, mcount, dpv). Return a substring extracted by matching with a regular expression and the index of matched token.

  * https://www.kamailio.org/docs/modules/devel/modules/textops.html#textops.f.regex_substring

==== tls ====

Add support for unique identifier PVs and select: $tls_peer_subject_uid and $tls_my_subject_uid, new selects: uid, uniqueIdentifier and unique_identifier.

  * https://www.kamailio.org/wiki/cookbooks/devel/pseudovariables#tls_peer_subject_uid
  * https://www.kamailio.org/wiki/cookbooks/devel/pseudovariables#tls_my_subject_uid

==== tmx ====

Add a new function t_drop([rcode])

  * https://www.kamailio.org/docs/modules/devel/modules/tmx.html#tmx.f.t_drop

==== kex ====

New rpc command mod.mem_statsx, to print also the count of allocated chunks in summary.

  * https://www.kamailio.org/docs/modules/devel/modules/kex.html#kex.r.mod.mem_statsx

==== pv ====

New pseudo-variable $rcv(key), available inside event_route[core:msg-received] to get details of the received message.

  * https://www.kamailio.org/wiki/cookbooks/devel/pseudovariables#received_data_attributes

==== mqueue ====

Add a new rpc command mqueue.fetch

  * https://www.kamailio.org/docs/modules/devel/modules/mqueue.html#mqueue.f.mq_fetch

==== ims_ipsec_pcscf ====

Add IPv6 support to the ims_ipsec_pcscf module. Set authentication algorithm for SA depending of parsed security-client info from REGISTER request message. For now, the supported algorithms are md5 and sha1, the default algorithm is sha1.

Additional support for multiple TCP connections was added.

  * https://www.kamailio.org/docs/modules/devel/modules/ims_ipsec_pcscf.html

==== ims_registrar_pcscf ====

Add support for multiple TCP connections to the ims_registrar_pcscf module.

  * https://www.kamailio.org/docs/modules/devel/modules/ims_registrar_pcscf.html

==== ims_usrloc_pcscf ====

Add support for multiple TCP connections to the ims_usrloc_pcscf module.

  * https://www.kamailio.org/docs/modules/devel/modules/ims_usrloc_pcscf.html

==== ims_isc ====

Add functionality to a add-on to third party registration in S-CSCF. The feature assumes two new flags in HSS database, where additional to the "Service Info XML" an "insertRegisterRequest" flag or an "insertRegisterResponse" flag can be set. These flags are sent with the SAR/SAA exchange to the S-CSCF. More information can be found in the commit message (99b2cfaf4151968a62) and the module documentation.

  * https://www.kamailio.org/docs/modules/devel/modules/ims_isc.html

==== ims_usrloc_scscf ====

Add-on to third party registration in S-CSCF to the ims_usrloc_scscf module.

  * https://www.kamailio.org/docs/modules/devel/modules/ims_usrloc_scscf.html

==== ims_registrar_scscf ====

Add-on to third party registration in S-CSCF to the ims_registrar_scscf module.

  * https://www.kamailio.org/docs/modules/devel/modules/ims_registrar_scscf.html


===== New in Core =====

==== Command line arguments ====

Adding support for long option names, to kamailio. This makes it easier to deploy Kamailio in dynamic environments like containers. Examples:

  * add domain aliases with --alias
  * set advertised address to listen sockets speficied with -l socket/advertise
  * set server id with --server-id
  * set a subst, substdef or substdefs preprocessor expression with --subst, --substdef or --substdefs

More information: https://www.kamailio.org/w/2019/05/kamailio-command-line-arguments/

==== Interpreter ====

==== Parameters ====

New global parameter bind_ipv6_link_local. If set to 1, try to bind also IPv6 link local addresses by discovering the scope of the interface. This apply for UDP socket for now, to be added for the other protocols.
  * https://www.kamailio.org/wiki/cookbooks/devel/core#bind_ipv6_link_local

Introduce new configuration parameter tcp_accept_haproxy parameter. When active, inbound TCP connections are expected to behave according to the HA PROXY protocol. Both the v1 (human-readable) and v2 (binary) versions of the protocol are supported.
  * https://www.kamailio.org/wiki/cookbooks/devel/core#tcp_accept_haproxy

==== Functions ====

  * New rpc command core.psa - to print attributes stored in process table, similar to core.psx, but also prints the rank and status fields 

==== Memory Managers ====

Refactoring and unification of memory allocation error logging infrastructure. Completed in the core, major modules were migrated as well.
==== Architecture ====

  * Extend internal IPv4 and IPv6 parsing functions in the core

==== kamailio.cfg ====

===== Tools =====

==== kamcmd ====

==== kamctl ====

Added subcommand to print the server version using rpc command: kamctl srv version 

Added subcommand to delete older expired records from database table: kamctl ul dbclean [<secs>]

==== kamcli ====
